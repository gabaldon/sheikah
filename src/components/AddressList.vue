<template>
  <div class="list" :class="{ 'vertical-align': !isMaxHeightExceeded }">
    <AddressCard
      v-for="(address, index) in addresses"
      ref="address"
      :key="index"
      class="item"
      :used="address.used"
      :selected="selected === index"
      @click="() => selectAddress(index)"
    />
    <AddressCardButton ref="addAddress" @click="$emit('generate-address')" />
  </div>
</template>

<script>
import { mapState } from 'vuex'
import AddressCard from '@/components/AddressCard.vue'
import AddressCardButton from '@/components/AddressCardButton.vue'

/**
 * List of all the addresses generated by the wallet
 */
export default {
  name: 'AddressList',
  components: {
    AddressCard,
    AddressCardButton,
  },
  props: {
    /**
     * Addresses generated
     */
    addresses: {
      type: Array,
      required: true,
    },
    /**
     * Address selected
     */
    selected: {
      type: Number,
      default: 0,
    },
  },
  computed: {
    ...mapState({
      isRadiantBorderActive: state =>
        state.uiInteractions.receiveTransactionClicked,
    }),
    isMaxHeightExceeded() {
      // FIXME: calculate a the height in a more agnostic way
      return this.addresses.length > 26
    },
  },
  watch: {
    isRadiantBorderActive(val) {
      if (val) {
        this.$refs.addAddress.focus()
      }
    },
  },
  methods: {
    selectAddress(index) {
      /**
       * Emit the index of the new selected address
       */
      this.$emit('select-address', index)
    },
  },
}
</script>

<style lang="scss" scoped>
@import '@/styles/_colors.scss';
@import '@/styles/scroll.scss';

.list {
  align-items: center;
  background-color: var(--addresses-list-background);
  border-bottom: 1px solid $grey-1;
  box-sizing: border-box;
  display: grid;
  gap: 6px;
  grid-template-columns: repeat(auto-fit, 25px);
  grid-template-rows: repeat(auto-fit, 40px);
  height: 170px;
  justify-content: center;
  max-height: 170px;
  overflow: auto;
  padding: 25px;

  &.vertical-align {
    align-content: center;
  }
}
</style>

<docs>
### Example

```jsx
  <AddressList
    :style="{ width: '350px' }"
    :addresses="[ {
      address: 'twit1270yg7pkm2w9mlq56r0mzrwph3flrp862zw0ft',
      index: 0,
      used: false,
      amount: 5000,
      unit: 'nanoWits',
      firstPaymentDate: new Date(),
      lastPaymentDate: new Date(),
      payments: 0,
    },
    {
      address: 'twit1270yg7pkm2w9mlq56r0mzrwph3flrp862zw0fa',
      index: 0,
      used: false,
      amount: 5000,
      unit: 'nanoWits',
      firstPaymentDate: new Date(),
      lastPaymentDate: new Date(),
      payments: 1,
    }]"
  />
```
</docs>
